<!doctype html>
<html lang="me">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vukova sva≈°tara | Meni (Flipbook)</title>
  <meta name="description" content="Moderan restoranski meni na engleskom i crnogorskom, sa flipbook animacijom." />

  <style>
    :root{
      /* Elegant black & gold palette */
      --bg: #050505;
      --bg2: #0b0b0b;

      --paper: #121212;
      --paper-soft: #161616;

      --card: rgba(255,255,255,.05);
      --card2: rgba(255,255,255,.08);

      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.65);
      --line: rgba(255,255,255,.14);

      --accent: #f2c14e;      /* elegant gold */
      --accent-soft: #f7d87c;

      --shadow: 0 30px 80px rgba(0,0,0,.75);

      --radius: 24px;
      --page-radius: 20px;

      --book-w: min(980px, 94vw);
      --book-h: min(640px, 78vh);

      --flip-dur: 1100ms;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(242,193,78,.12), transparent 60%),
        radial-gradient(900px 520px at 80% 20%, rgba(242,193,78,.06), transparent 65%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding: 28px 18px 34px;
      gap: 18px;
    }

    header{
      width: var(--book-w);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }

    .brand h1{
      margin:0;
      font-size: clamp(22px, 2.8vw, 34px);
      letter-spacing: .2px;
      line-height:1.08;
    }

    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      justify-content:flex-end;
      align-items:center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 10px 34px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select:none;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .seg{
      display:flex;
      border: 1px solid var(--line);
      border-radius: 999px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
    }

    .seg button{
      border:0;
      background: transparent;
      color: var(--muted);
      padding: 9px 12px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.25px;
    }

    .seg button.active{
      color: rgba(255,255,255,.96);
      background: linear-gradient(180deg, rgba(242,193,78,.22), rgba(242,193,78,.10));
    }

    .status{
      color: var(--muted);
      font-size: 12px;
      font-weight:800;
      letter-spacing:.25px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }

    /* Book */
    .stage{
      perspective: 2200px;
      width: var(--book-w);
      height: var(--book-h);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }

    .book{
      width: 100%;
      height: 100%;
      position:relative;
      transform-style: preserve-3d;
      border-radius: var(--radius);
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(242,193,78,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.14);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .spineGlow{
      position:absolute;
      left: 50%;
      top: 0;
      width: 2px;
      height: 100%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, transparent, rgba(242,193,78,.45), transparent);
      opacity:.70;
      pointer-events:none;
    }

    .page{
      position:absolute;
      inset: 14px;
      border-radius: var(--page-radius);
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform var(--flip-dur) cubic-bezier(.18,.9,.2,1);
      will-change: transform;
      cursor: pointer;

      /* curl progress + side */
      --p: 0;        /* 0..1 */
      --dir: 1;      /* 1 forward, -1 backward (for mirrored shading) */
    }

    .page .front,
    .page .back{
      position:absolute;
      inset:0;
      border-radius: var(--page-radius);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);

      /* Opaque paper (prevents see-through) */
      background: linear-gradient(180deg, var(--paper), var(--paper-soft));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.05),
        inset 0 -20px 40px rgba(0,0,0,.45);
    }

    .page .back{
      transform: rotateY(180deg);
    }

    /* Subtle paper grain */
    .grain{
      position:absolute;
      inset:0;
      opacity:.06;
      pointer-events:none;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      z-index: 0;
    }

    /* Page stacking */
    .page{ z-index: 10; }
    .page[data-index="0"]{ z-index: 20; }
    .page[data-index="1"]{ z-index: 19; }
    .page[data-index="2"]{ z-index: 18; }
    .page[data-index="3"]{ z-index: 17; }
    .page[data-index="4"]{ z-index: 16; }
    .page[data-index="5"]{ z-index: 15; }

    /* Flipped state */
    .page.flipped{ transform: rotateY(-180deg); }

    /* ===== Magazine-like curl shading (works both directions) ===== */
    /* General shadow */
    .page::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: var(--page-radius);
      pointer-events:none;
      opacity: 1;
      mix-blend-mode: multiply;

      /* shadow changes with direction via --dir */
      background:
        radial-gradient(700px 500px at calc(50% + (36% * var(--dir))) 50%,
          rgba(0,0,0, calc(.12 + .55*var(--p))) 0%,
          rgba(0,0,0, 0) 58%),
        linear-gradient(calc(90deg * var(--dir)),
          rgba(0,0,0, calc(.10 + .30*var(--p))) 0%,
          rgba(0,0,0, 0) 55%,
          rgba(0,0,0, calc(.10 + .45*var(--p))) 100%);
    }

    /* Curl highlight edge (right by default) */
    .page .front::before,
    .page .back::before{
      content:"";
      position:absolute;
      top:0; bottom:0;
      right:0;
      width: 52px;
      pointer-events:none;
      border-radius: 0 var(--page-radius) var(--page-radius) 0;
      background:
        linear-gradient(90deg,
          rgba(0,0,0,0) 0%,
          rgba(255,255,255, calc(.04 + .22*var(--p))) 32%,
          rgba(255,255,255, calc(.02 + .14*var(--p))) 55%,
          rgba(0,0,0, calc(.08 + .62*var(--p))) 78%,
          rgba(0,0,0, calc(.12 + .78*var(--p))) 100%);
      opacity: 1;
      transform: translateZ(1px);
    }

    /* When flipping backward, move curl to LEFT (mirrored) */
    .page[data-curl="left"] .front::before,
    .page[data-curl="left"] .back::before{
      left:0;
      right:auto;
      border-radius: var(--page-radius) 0 0 var(--page-radius);
      background:
        linear-gradient(270deg,
          rgba(0,0,0,0) 0%,
          rgba(255,255,255, calc(.04 + .22*var(--p))) 32%,
          rgba(255,255,255, calc(.02 + .14*var(--p))) 55%,
          rgba(0,0,0, calc(.08 + .62*var(--p))) 78%,
          rgba(0,0,0, calc(.12 + .78*var(--p))) 100%);
    }

    /* Content layout */
    .content{
      position: relative;
      z-index: 1;
      height:100%;
      padding: 22px 22px 18px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .topline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }

    .titleBlock{ display:flex; flex-direction:column; gap: 6px; }

    .pageTitle{
      font-size: 18px;
      margin:0;
      letter-spacing:.2px;
    }

    .subtitle{
      margin:0;
      font-size: 13px;
      color: var(--muted);
    }

    .badge{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.40px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(242,193,78,.45);
      background: rgba(242,193,78,.14);
      color: rgba(255,255,255,.95);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding-top: 6px;
      overflow:auto;
    }

    .item{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }

    .item h4{
      margin:0;
      font-size: 14px;
      letter-spacing:.15px;
    }

    .item p{
      margin: 6px 0 0;
      font-size: 12.5px;
      color: var(--muted);
      line-height:1.35;
    }

    .price{
      font-weight: 900;
      letter-spacing:.3px;
      color: var(--accent);
      padding-left: 8px;
      white-space:nowrap;
      align-self:start;
    }

    .foot{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
    }

    .dots{
      display:flex;
      align-items:center;
      gap: 6px;
    }

    .dot{
      width: 7px;
      height: 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      opacity:.55;
    }

    .dot.active{
      opacity: 1;
      border-color: rgba(242,193,78,.60);
      background: rgba(242,193,78,.30);
    }

    /* Mobile tweaks */
    @media (max-width: 720px){
      header{ align-items:stretch; }
      .controls{ justify-content:flex-start; }
      .stage{ height: min(680px, 72vh); }
      .page{ inset: 12px; }
      .content{ padding: 18px 16px 14px; }
      .item{ grid-template-columns: 1fr; }
      .price{ padding-left: 0; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .page{ transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1 id="brandName">Restoran Vukova sva≈°tara</h1>
        <p id="brandTag">Meni ‚Ä¢ Sezonski specijaliteti ‚Ä¢ Kumbor</p>
      </div>

      <div class="controls">
        <div class="pill toggle" aria-label="Language">
          <span style="color:var(--muted); font-size:12px; font-weight:900; letter-spacing:.3px;">LANG</span>
          <div class="seg" role="tablist" aria-label="Language switch">
            <button id="langME" class="active" role="tab" aria-selected="true">ME</button>
            <button id="langEN" role="tab" aria-selected="false">EN</button>
          </div>
        </div>

        <div class="pill status" id="status" aria-label="Page status">Strana 1 / 6</div>
      </div>
    </header>

    <div class="stage" aria-label="Flipbook menu">
      <div class="book" id="book">
        <div class="spineGlow"></div>
        <!-- Pages injected by JS -->
      </div>
    </div>
  </div>

  <script>
    // ------------------------------
    // 1) PODACI MENIJA (ME + EN)
    // ------------------------------
    const MENU = {
      brand: {
        name: { me: "Restoran Vukova sva≈°tara", en: "Vukova sva≈°tara Restaurant" },
        tag:  { me: "Meni ‚Ä¢ Sezonski specijaliteti ‚Ä¢ Kumbor", en: "Menu ‚Ä¢ Seasonal specials ‚Ä¢ Kumbor" },
      },
      pages: [
        {
          id: "cover",
          badge: { me: "Dobro do≈°li", en: "Welcome" },
          title: { me: "Meni", en: "Menu" },
          subtitle: { me: "", en: "" }, /* removed instruction text */
          items: [
            { name: { me: "Radno vrijeme", en: "Opening hours" }, desc: { me: "Pon‚ÄìNed: 08:00‚Äì23:00", en: "Mon‚ÄìSun: 08:00‚Äì23:00" }, price: "" },
            { name: { me: "Wi-Fi", en: "Wi-Fi" }, desc: { me: "Mre≈æa: Vukova ‚Ä¢ Lozinka: coffee", en: "Network: Vukova ‚Ä¢ Pass: coffee" }, price: "" },
            { name: { me: "Alergeni", en: "Allergens" }, desc: { me: "Pitajte osoblje za listu alergena.", en: "Ask our staff for the allergen list." }, price: "" },
          ],
          footer: { me: "Hvala ≈°to ste svratili üíõ", en: "Thanks for visiting üíõ" }
        },
        {
          id: "breakfast",
          badge: { me: "Doruƒçak", en: "Breakfast" },
          title: { me: "Doruƒçak", en: "Breakfast" },
          subtitle: { me: "Svje≈æe, lagano i brzo", en: "Fresh, light & quick" },
          items: [
            { name: { me: "Avokado tost", en: "Avocado toast" }, desc: { me: "Hljeb od kiselog tijesta, avokado, limeta, ƒçili", en: "Sourdough, avocado, lime, chili" }, price: "6.50‚Ç¨" },
            { name: { me: "Omlet kuƒáe", en: "House omelet" }, desc: { me: "Jaja, feta, spanaƒá, cherry paradajz", en: "Eggs, feta, spinach, cherry tomatoes" }, price: "7.20‚Ç¨" },
            { name: { me: "Granola bowl", en: "Granola bowl" }, desc: { me: "Jogurt, granola, med, bobiƒçasto voƒáe", en: "Yogurt, granola, honey, berries" }, price: "5.80‚Ç¨" },
          ],
          footer: { me: "Doruƒçak se slu≈æi do 12:00", en: "Breakfast served until 12:00" }
        },
        {
          id: "starters",
          badge: { me: "Predjela", en: "Starters" },
          title: { me: "Predjela", en: "Starters" },
          subtitle: { me: "Za dijeljenje ili kao uvod", en: "To share or start" },
          items: [
            { name: { me: "Brusketi", en: "Bruschetta" }, desc: { me: "Paradajz, bosiljak, maslinovo ulje", en: "Tomato, basil, olive oil" }, price: "5.90‚Ç¨" },
            { name: { me: "Krem supa od bundeve", en: "Pumpkin cream soup" }, desc: { me: "Bundeva, ƒëumbir, pavlaka", en: "Pumpkin, ginger, cream" }, price: "4.80‚Ç¨" },
            { name: { me: "Daska sireva", en: "Cheese board" }, desc: { me: "Selekcija sireva, orasi, suve smokve", en: "Cheese selection, walnuts, dried figs" }, price: "10.50‚Ç¨" },
          ],
          footer: { me: "Vegetarijanske opcije dostupne", en: "Vegetarian options available" }
        },
        {
          id: "mains",
          badge: { me: "Glavna jela", en: "Mains" },
          title: { me: "Glavna jela", en: "Mains" },
          subtitle: { me: "Klasici sa modernim twist-om", en: "Classics with a modern twist" },
          items: [
            { name: { me: "Piletina u sosu od peƒçuraka", en: "Chicken in mushroom sauce" }, desc: { me: "File, peƒçurke, pire krompir", en: "Chicken breast, mushrooms, mashed potatoes" }, price: "11.90‚Ç¨" },
            { name: { me: "Ri≈æoto sa kozicama", en: "Shrimp risotto" }, desc: { me: "Kozice, limun, parmezan", en: "Shrimp, lemon, parmesan" }, price: "13.50‚Ç¨" },
            { name: { me: "Veggie bowl", en: "Veggie bowl" }, desc: { me: "Quinoa, povrƒáe, hummus, tahini", en: "Quinoa, veggies, hummus, tahini" }, price: "10.20‚Ç¨" },
          ],
          footer: { me: "Prilozi po izboru", en: "Sides of your choice" }
        },
        {
          id: "desserts",
          badge: { me: "Deserti", en: "Desserts" },
          title: { me: "Deserti", en: "Desserts" },
          subtitle: { me: "Slatki kraj", en: "A sweet finish" },
          items: [
            { name: { me: "ƒåizkejk", en: "Cheesecake" }, desc: { me: "Vanila, ≈°umsko voƒáe", en: "Vanilla, forest berries" }, price: "5.40‚Ç¨" },
            { name: { me: "Tiramisu", en: "Tiramisu" }, desc: { me: "Kafa, mascarpone, kakao", en: "Coffee, mascarpone, cocoa" }, price: "5.60‚Ç¨" },
            { name: { me: "Domaƒái sladoled", en: "Homemade ice cream" }, desc: { me: "2 kugle ‚Ä¢ ukusi sezonski", en: "2 scoops ‚Ä¢ seasonal flavors" }, price: "4.50‚Ç¨" },
          ],
          footer: { me: "Pitajte za desert dana", en: "Ask for dessert of the day" }
        },
        {
          id: "drinks",
          badge: { me: "Piƒáa", en: "Drinks" },
          title: { me: "Piƒáa", en: "Drinks" },
          subtitle: { me: "Kafa, ƒçaj i osvje≈æenja", en: "Coffee, tea & refreshers" },
          items: [
            { name: { me: "Espresso", en: "Espresso" }, desc: { me: "Klasiƒçan", en: "Classic" }, price: "1.60‚Ç¨" },
            { name: { me: "Cappuccino", en: "Cappuccino" }, desc: { me: "Sa pjenom od mlijeka", en: "With milk foam" }, price: "2.30‚Ç¨" },
            { name: { me: "Domaƒái ledeni ƒçaj", en: "Homemade iced tea" }, desc: { me: "Limun / breskva", en: "Lemon / peach" }, price: "2.80‚Ç¨" },
          ],
          footer: { me: "Napitak dana u ponudi", en: "Daily special available" }
        },
      ]
    };

    // ------------------------------
    // 2) RENDER + FLIPBOOK LOGIKA
    //    Elegant click + swipe flip (no drag text, no half-hold)
    // ------------------------------
    const book = document.getElementById('book');
    const statusEl = document.getElementById('status');
    const langME = document.getElementById('langME');
    const langEN = document.getElementById('langEN');

    let lang = 'me';
    let pageIndex = 0;

    function el(tag, attrs={}, children=[]) {
      const node = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)) {
        if (k === 'class') node.className = v;
        else if (k.startsWith('data-')) node.setAttribute(k, v);
        else if (k === 'html') node.innerHTML = v;
        else node.setAttribute(k, v);
      }
      for (const ch of children) node.appendChild(typeof ch === 'string' ? document.createTextNode(ch) : ch);
      return node;
    }

    function t(obj){
      if (!obj) return '';
      return obj[lang] ?? obj.me ?? obj.en ?? '';
    }

    function setBrand(){
      document.documentElement.lang = lang;
      document.getElementById('brandName').textContent = t(MENU.brand.name);
      document.getElementById('brandTag').textContent  = t(MENU.brand.tag);
    }

    function renderPages(){
      book.querySelectorAll('.page').forEach(p => p.remove());

      MENU.pages.forEach((p, i) => {
        const page = el('div', { class: 'page', 'data-index': String(i), 'aria-label': `Page ${i+1}`, 'data-curl': 'right' });

        const front = el('div', { class: 'front' }, [
          el('div', { class:'grain' }),
          renderContent(p, i)
        ]);

        const back = el('div', { class: 'back' }, [
          el('div', { class:'grain' }),
          renderBackContent(p, i)
        ]);

        page.appendChild(front);
        page.appendChild(back);
        book.appendChild(page);
      });

      syncFlipState(true);
      updateDots();
      updateStatus();
    }

    function renderContent(p, i){
      const items = p.items || [];
      const grid = el('div', { class: 'grid' }, items.map(item => {
        return el('div', { class: 'item' }, [
          el('div', {}, [
            el('h4', {}, [t(item.name)]),
            el('p', {}, [t(item.desc)])
          ]),
          el('div', { class: 'price' }, [item.price || ''])
        ]);
      }));

      const dots = el('div', { class: 'dots', 'aria-label': 'Progress dots' }, MENU.pages.map((_, di) => {
        return el('div', { class: 'dot' + (di===i ? ' active':''), 'data-dot': String(di) });
      }));

      const foot = el('div', { class: 'foot' }, [
        el('span', {}, [p.footer ? t(p.footer) : '']),
        dots,
      ]);

      return el('div', { class: 'content' }, [
        el('div', { class: 'topline' }, [
          el('div', { class: 'titleBlock' }, [
            el('h3', { class: 'pageTitle' }, [t(p.title)]),
            el('p', { class: 'subtitle' }, [t(p.subtitle)])
          ]),
          el('div', { class: 'badge' }, [t(p.badge)])
        ]),
        grid,
        foot
      ]);
    }

    function renderBackContent(p, i){
      const next = MENU.pages[i+1];
      const label = next ? `${t(next.badge)} ‚Ä¢ ${t(next.title)}` : (lang==='me' ? 'Kraj menija' : 'End of menu');
      return el('div', { class: 'content' }, [
        el('div', { class: 'topline' }, [
          el('div', { class: 'titleBlock' }, [
            el('h3', { class: 'pageTitle' }, [lang==='me' ? 'Sljedeƒáe' : 'Next']),
            el('p', { class: 'subtitle' }, [label])
          ]),
          el('div', { class: 'badge' }, [lang==='me' ? 'Okreni stranu' : 'Flip page'])
        ]),
        el('div', { class: 'grid' }, [
          el('div', { class: 'item' }, [
            el('div', {}, [
              el('h4', {}, [lang==='me' ? 'Info' : 'Info']),
              el('p', {}, [lang==='me' ? 'Dodirni lijevo/desno da lista≈°.' : 'Tap left/right to flip.'])
            ]),
            el('div', { class: 'price' }, [''])
          ])
        ]),
        el('div', { class: 'foot' }, [
          el('span', {}, ['¬© ' + new Date().getFullYear() + ' Vukova sva≈°tara']),
          el('span', {}, [''])
        ])
      ]);
    }

    function syncFlipState(resetP=false){
      const pages = Array.from(book.querySelectorAll('.page'));
      pages.forEach((p, i) => {
        if (resetP) p.style.setProperty('--p', '0');
        // set correct curl side depending on direction
        p.dataset.curl = (i < pageIndex) ? 'left' : 'right';
        p.style.setProperty('--dir', (i < pageIndex) ? '-1' : '1');

        if (i < pageIndex) p.classList.add('flipped');
        else p.classList.remove('flipped');
      });
    }

    function updateStatus(){
      const total = MENU.pages.length;
      const current = Math.min(pageIndex + 1, total);
      statusEl.textContent = lang === 'me'
        ? `Strana ${current} / ${total}`
        : `Page ${current} / ${total}`;
    }

    function updateDots(){
      book.querySelectorAll('[data-dot]').forEach(d => {
        const idx = Number(d.getAttribute('data-dot'));
        d.classList.toggle('active', idx === pageIndex);
      });
    }

    function animateFlip(nextIndex){
      const total = MENU.pages.length;
      nextIndex = Math.max(0, Math.min(total - 1, nextIndex));
      if (nextIndex === pageIndex) return;

      const dir = (nextIndex > pageIndex) ? 1 : -1; // 1 forward, -1 back
      const movingIdx = (dir === 1) ? pageIndex : (pageIndex - 1);
      const movingPage = book.querySelector(`.page[data-index="${movingIdx}"]`);
      if (!movingPage) return;

      // set curl direction for the moving page
      movingPage.dataset.curl = (dir === 1) ? 'right' : 'left';
      movingPage.style.setProperty('--dir', String(dir));

      // Animate curl progress in sync with CSS rotate
      const duration = 520;
      const start = performance.now();

      function tick(now){
        const t = Math.min(1, (now - start) / duration);
        // ease
        const ease = 1 - Math.pow(1 - t, 3);
        // p should peak around mid-flip
        const p = Math.sin(ease * Math.PI); // 0..1..0
        movingPage.style.setProperty('--p', String(p));
        if (t < 1) requestAnimationFrame(tick);
        else movingPage.style.setProperty('--p', '0');
      }
      requestAnimationFrame(tick);

      pageIndex = nextIndex;
      syncFlipState(false);
      updateDots();
      updateStatus();
    }

    // Click / tap on left-right half: flip like a magazine (smooth, no dragging)
    book.addEventListener('click', (e) => {
      const rect = book.getBoundingClientRect();
      const x = e.clientX - rect.left;
      if (x > rect.width * 0.56) animateFlip(pageIndex + 1);
      else if (x < rect.width * 0.44) animateFlip(pageIndex - 1);
    });

    // Swipe (mobile)
    let touchStartX = 0, touchStartY = 0, touching = false;
    book.addEventListener('touchstart', (e) => {
      if (!e.touches || e.touches.length !== 1) return;
      touching = true;
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }, { passive: true });

    book.addEventListener('touchend', (e) => {
      if (!touching) return;
      touching = false;
      const t = e.changedTouches && e.changedTouches[0];
      if (!t) return;

      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;

      if (Math.abs(dx) > 48 && Math.abs(dy) < 60) {
        if (dx < 0) animateFlip(pageIndex + 1);
        else animateFlip(pageIndex - 1);
      }
    }, { passive: true });

    // Keyboard (optional)
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); animateFlip(pageIndex + 1); }
      if (e.key === 'ArrowLeft') { e.preventDefault(); animateFlip(pageIndex - 1); }
    }, { passive: false });

    // Language switch
    function setLang(newLang){
      lang = newLang;
      langME.classList.toggle('active', lang==='me');
      langEN.classList.toggle('active', lang==='en');
      langME.setAttribute('aria-selected', lang==='me' ? 'true':'false');
      langEN.setAttribute('aria-selected', lang==='en' ? 'true':'false');

      setBrand();
      renderPages();
    }
    langME.addEventListener('click', () => setLang('me'));
    langEN.addEventListener('click', () => setLang('en'));

    // Init
    setBrand();
    renderPages();
  </script>
</body>
</html>

